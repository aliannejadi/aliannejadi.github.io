<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://api.keytrac.net/keytrac.js"></script>
<script src="https://timbrady.org/turk/TimTurkTools.js"></script>


<style type="text/css">.Selected {
    opacity: 0.3;
    color: #966;
}

.btn-with-margin {
    margin-right: 2px;
    margin-bottom: 2px;
}

.img-thumbnail-padding {
    padding: 1px;
}

.bt-padding {
    padding-top: 2px;
    padding-right: 2px;
    padding-bottom: 2px;
    padding-left: 2px;
}

.awesomplete [hidden] {
    display: none;
}

.awesomplete .visually-hidden {
    position: absolute;
    clip: rect(0, 0, 0, 0);
}

.awesomplete {
    display: inline-block;
    position: relative;
}

.awesomplete > input {
    display: block;
}

.awesomplete > ul {
    position: absolute;
    left: 0;
    z-index: 1;
    min-width: 100%;
    box-sizing: border-box;
    list-style: none;
    padding: 0;
    margin: 0;
    background: #fff;
}

.awesomplete > ul:empty {
    display: none;
}

.awesomplete > ul {
    border-radius: .3em;
    margin: .2em 0 0;
    background: hsla(0, 0%, 100%, .9);
    background: linear-gradient(to bottom right, white, hsla(0, 0%, 100%, .8));
    border: 1px solid rgba(0, 0, 0, .3);
    box-shadow: .05em .2em .6em rgba(0, 0, 0, .2);
    text-shadow: none;
}

@supports (transform: scale(0)) {
    .awesomplete > ul {
        transition: .3s cubic-bezier(.4, .2, .5, 1.4);
        transform-origin: 1.43em -.43em;
    }

    .awesomplete > ul[hidden],
    .awesomplete > ul:empty {
        opacity: 0;
        transform: scale(0);
        display: block;
        transition-timing-function: ease;
    }
}

/* Pointer */
.awesomplete > ul:before {
    content: "";
    position: absolute;
    top: -.43em;
    left: 1em;
    width: 0;
    height: 0;
    padding: .4em;
    background: white;
    border: inherit;
    border-right: 0;
    border-bottom: 0;
    -webkit-transform: rotate(45deg);
    transform: rotate(45deg);
}

.awesomplete > ul > li {
    position: relative;
    padding: .2em .5em;
    cursor: pointer;
}

.awesomplete > ul > li:hover {
    background: hsl(200, 40%, 80%);
    color: black;
}

.awesomplete > ul > li[aria-selected="true"] {
    background: hsl(205, 40%, 40%);
    color: white;
}

.awesomplete mark {
    background: hsl(65, 100%, 50%);
}

.awesomplete li:hover mark {
    background: hsl(68, 100%, 41%);
}

.awesomplete li[aria-selected="true"] mark {
    background: hsl(86, 100%, 21%);
    color: inherit;
}

/*# sourceMappingURL=awesomplete.css.map */
</style>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<section class="container" id="SurveyLink"><!-- Instructions -->
    <div class="row">
        <div class="col-xs-12 col-md-12">
            <div class="panel panel-danger">
                <!-- WARNING: the ids "collapseTrigger" and "instructionBody" are being used to enable expand/collapse feature --><a
                    class="panel-heading" href="javascript:void(0);" id="collapseTrigger" style="color:000;"><span
                    style="color:#000000;"><strong>Instructions and examples</strong> <span class="collapse-text">(Click to expand)</span></span>
            </a>
                <div class="panel-body" id="instructionBody">
                    <div class="alert alert-info">

                        <h3>Task Description:</h3>

                        Welcome, and thanks for your interest. <br>
                        In this HIT, we would like to record user behavior when interacting with different search engine
                        result pages. Therefore, we assume that there are queries submitted to a search engine and users
                        can interact with the results. In this task we specifically concerned with search on an e-commerce marketplace, as well as a scholary papers. <br>
                        Each HIT shows a search engine result page in response to a search query. 

                        All you need to do is to read the initial query on the top of the screen, and check the results that you see to pick the one that you would like to buy, or read as a paper.
                        This HIT should be done on your <strong>PC</strong>, with a working <strong>webcam</strong> because we will run an eye tracking software.

                        <h3>What you need to do:</h3>

                        <ul>
                            <li>Click on the link below, which will take you to the RealEye website. RealEye will use your webcam to record your eye movement.</li>
                            <li>Complete RealEye session. It will ask for access to your webcam.</li>
                            <li>After completing the calibration session, the eye tracking session will start.</li>
                            <li>You are given a search engine result page containing a query and some Amazon products.
                            </li>
                            <li>Go over the list of items, and find the best one. The one you would buy (do not worry about the price!) or select as the next paper to read.
                            </li>
                            <li>You will have to look at the items for about 20 seconds per page. Once the time is over you will be forwarded to a new web page.</li>
                            <li>After finishing the task you will see a survey page, you can ignore that.
                            <!-- <li>Finally, we ask you to judge the quality of the conversation. Please mark as many checkboxes as it applies to the current conversation to let us know how you feel about the SYSTEM's questions in the conversation. -->
                            <!-- <li style="font-family: Verdana, Geneva, sans-serif; font-size: 11.7px;">After receiving your answer, does the system need to ask a follow-up question for more clarification? If yes, please check the corresponding box.&nbsp;</li> -->
                        </ul>

                    </div>

                    <div class="alert alert-danger">
                        <h3>IMPORTANT:</h3>

                        <ul>
                            <li> You <strong>MUST</strong> complete this HIT on your desktop or laptop with a working webcam.
                            </li>
                            <li>RealEye is a GDPR-compliant company. Therefore, we assure you that it <strong>DOES NOT</strong> record and store your camera video.</li>
                        </ul>
                    </div>

                    
                </div>
            </div>
        </div>


    </div>

    <section>
        <fieldset>

            <div class="panel panel-info" id="instructionBody1">
                <div class="panel-heading">Eye Tracking Task</div>

                <div class="panel-body" style="padding: 20;">

                    <div class="form-group">

                    	<div class='col-md-12 col-sm-12 col-lg-12 col-xs-12'>
                        	<label for="realeye_link">Click on the link to RealEye website: </label> <br>
                        </div>
                        <div class='col-md-12 col-sm-12 col-lg-12 col-xs-12'>                            
                            <a href="https://www.realeye.io/test/c2caaf05-1060-47be-b125-51f0e1d51a7b/run" target="_blank" id="realeye_link">Eye Tracking Study</a>
                        </div>
                        <br><br>
          
                        <br>
                        <ul id="search_result_container" style="list-style-type:none;">

                        </ul>
                    </div>
                </div>
            </div>


        </fieldset>
        <input id="deviceType" name="deviceType" type="hidden" value=""/> <input id="screenSize" name="screenSize"
                                                                                 type="hidden" value=""/></section>
    <input id="shuffledList" name="shuffledList" type="hidden" value=""/>
    <input id="checkedboxlist" name="checkedboxlist" type="hidden" value=""/>
    <input id="mouse_hover_events" name="mouse_hover_events" type="hidden" value=""/>
    <input id="question1_answer" name="question1_answer" type="hidden" value=""/>
    <input id="question2_answer" name="question2_answer" type="hidden" value=""/>
    <input id="question3_answer" name="question3_answer" type="hidden" value=""/>
    <input id="question4_answer" name="question4_answer" type="hidden" value=""/>
    
    <div id="questions_frame">

<h2>Survey Questions</h2>

<p>How old are you?</p>


  <div class="form-group">
      <div class='col-md-10 col-sm-12 col-lg-10 col-xs-12'>
    <select class="form-control form-control-sm" id="select1">
      <option>18-29</option>
      <option>30-39</option>
      <option>40-49</option>
      <option>50+</option>
    </select>
  </div>
    <br><br><br>
<p>What is the highest degree or level of education you have completed?</p>


  <div class="form-group">
      <div class='col-md-10 col-sm-12 col-lg-10 col-xs-12'>
    <select class="form-control form-control-sm" id="select2">
      <option>High School</option>
      <option>Bachelor's Degree</option>
      <option>Master's Degree</option>
      <option> Ph.D. or higher</option>
      <option>Prefer not to say</option>
      <option>other</option>
    </select>
  </div>
    <br><br><br>

    <p>Did you see any famous author name in the lists of articles?</p>


  <div class="form-group">
      <div class='col-md-10 col-sm-12 col-lg-10 col-xs-12'>
    <select class="form-control form-control-sm" id="select3">
      <option>Yes</option>
      <option>No</option>

    </select>
  </div>
    <br><br><br>
    <p>Which interval better describes the range for the number of citations you saw in the lists?</p>


  <div class="form-group">
      <div class='col-md-10 col-sm-12 col-lg-10 col-xs-12'>
    <select class="form-control form-control-sm" id="select4">
      <option>5-10</option>
      <option>0-500</option>
      <option>10-500</option>
      <option>700-8000</option>
      <option>50-8000</option>
      <option>0-7500</option>
    </select>
  </div>
    </div>
    <!-- End Content Body --></section>
<!-- close container -->
<style type="text/css">fieldset {
    padding: 10px;
    background: #fbfbfb;
    border-radius: 5px;
    margin-bottom: 5px;
}
</style>

<script>

    var isMobile = false; //initiate as false
    // device detection
    if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)
        || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0, 4))) isMobile = true;

    var startTime = new Date().getTime();

    glob_dict_timestamps = {
        'start': new Date().getTime(),
        'tasks': {}
    }
    glob_dict_answers = {
        'start': new Date().getTime(),
        'tasks': {}
    }

</script>

<script>

    //$(document).ready(function() {
    //   $.ajax({
    //       type: "GET",
    //        url: "data.txt",
    //       dataType: "text",
    //        success: function(data) {processData(data);}
    //     });
    //});

    //function processData(allText) {
    //    var allTextLines = allText.split(/\r\n|\n/);
    //    var headers = allTextLines[0].split(',');
    //    var lines = [];

    //   for (var i=1; i<allTextLines.length; i++) {
    //        var data = allTextLines[i].split(',');
    //        if (data.length == headers.length) {

    //            var tarr = [];
    //            for (var j=0; j<headers.length; j++) {
    //                tarr.push(headers[j]+":"+data[j]);
    //            }
    //            lines.push(tarr);
    //        }
    //    }
    //    console.log(lines)
    //}
    //</script>


<style type="text/css">#collapseTrigger {
    color: #fff;
    display: block;
    text-decoration: none;
}

#submitButton {
    white-space: normal;
    visibility: hidden;
}
.image {
    margin-bottom: 15px;
}

/* CSS for breaking long words/urls */
.dont-break-out {
    overflow-wrap: break-word;
    word-wrap: break-word;
    -ms-word-break: break-all;
    word-break: break-all;
    word-break: break-word;
    -ms-hyphens: auto;
    -moz-hyphens: auto;
    -webkit-hyphens: auto;
    hyphens: auto;
}
</style>
<!-- Close internal style sheet --><!-- External JS references -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js"
        integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"
        integrity="sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4"
        crossorigin="anonymous"></script><!-- Open internal javascript -->
<script>


    $(document).ready(function () {
        // Instructions expand/collapse
        var content = $('#instructionBody');
        var trigger = $('#collapseTrigger');
        // content.hide();
        $('.collapse-text').text('(Click to collapse)');
        trigger.click(function () {
            content.toggle();
            var isVisible = content.is(':visible');
            if (isVisible) {
                $('.collapse-text').text('(Click to collapse)');
            } else {
                $('.collapse-text').text('(Click to expand)');
            }
        });
        // end expand/collapse
    });


    (function ($) {
        $.fn.invisible = function () {
            return this.each(function () {
                $(this).hide();
            });
        };
        $.fn.visible = function () {
            return this.each(function () {
                $(this).show();
            });
        };
    }(jQuery));
    //
    // $(document).ready(function() {
    //
    //   $('#answer').popover();
    //
    //   $('#submitButton').click(function() {
    //         // var count_checked_inputs = $('input[type="radio"]:checked').length
    //         var count_written_answers = 0;
    //         for (var i=0; i<$('.annotation_task').length;i++){
    //           // console.log($('input[id="answer'+i+'"]').val())
    //           if($('input[id="answer'+i+'"]').val() != ''){
    //                 count_written_answers++;
    //           }
    //         }
    //         // console.log(count_written_answers, count_checked_inputs, $('.annotation_task').length);
    //         if ($('#answer').val() == '') {
    //           alert('Please provide an answer before submitting the HIT.');
    //           return false;
    //
    //         // } else if (count_checked_inputs < $('.annotation_task').length){
    //         //    alert('You have checked only ' + count_checked_inputs + ' follow-up indications. Please check all of them before submission.');
    //         //    return false;
    //         }else{
    //                 $('#input_timestamps').val(JSON.stringify(glob_dict_timestamps));
    //                 $('#input_answer_clicks').val(JSON.stringify(glob_dict_answers));
    //                 return true;
    //           }
    //     });
    //
    // });

    $(document).on('change', '.radio_answer', function () {
        let answer_id = $(this).data('answer_id');
        let the_answer = $(this).val();
        console.log(new Date().getTime())
        glob_dict_timestamps.tasks[answer_id].push(new Date().getTime());
        glob_dict_answers.tasks[answer_id].push(the_answer);
    });


    document.getElementById("deviceType").value = navigator.userAgent;
    document.getElementById("screenSize").value = window.screen.availWidth + ' x ' + window.screen.availHeight;



    // tableString += "</tbody>";
    // theContainer.innerHTML += tableString;

</script>

<script>

    function containsObject(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }

    var mouseEnterTime = {};
    var checkedCheckboxeslist = "";
    // Tracking Top Links Hover Menus
    function trackHoverIntent(selector, min_time, store_content, screen_size) {
        var timeoutId;
        var elements = window.document.querySelectorAll(selector);
        for (var i = 0; i < elements.length; i++) {
            elements[i].addEventListener('mouseenter', function (event) {
                mouseEnterTime[event.target.id] = event.timeStamp;
            });
            elements[i].addEventListener('mouseleave', function (event) {
                var targetElement = event.target || event.srcElement;
                var id = targetElement.id;
                var hovertime = Math.round(event.timeStamp - mouseEnterTime[id]);
                if (hovertime < min_time)
                    return null;
                var elementcontent = '';
                if (store_content) elementcontent = targetElement.getAttribute('value');

                var timestamp = mouseEnterTime[id];

                if (!containsObject(glob_dict_timestamps.mouse_in, id)) {
                    glob_dict_hover.mouse_in[id] = [];
                    glob_dict_hover.mouse_out[id] = [];
                }
                glob_dict_hover.mouse_in[id].push(mouseEnterTime[id]);
                glob_dict_hover.mouse_out[id].push(event.timeStamp);



                var checkedChecks = document.querySelectorAll(".check:checked");
                checkedCheckboxeslist = ""
                checkedChecks.forEach((checkbox) => {
                checkedCheckboxeslist = checkedCheckboxeslist + checkbox.id + ",";
                });



                console.log(JSON.stringify(checkedCheckboxeslist))
                console.log(glob_dict_hover)
//                         console.log(id + " mouse hoverer");
                timeoutId = null;
            });
        }


        for (var i = 0; i < elements.length; i++) {
            elements[i].addEventListener('mouseleave', function () {
                if (timeoutId) {
                    window.clearTimeout(timeoutId);
                    timeoutId = null;
                }
            });
        }
    }

    var screen_size = $(window).width() + 'x' + $(window).height();
    glob_dict_hover = {
        'start': new Date().getTime(),
        'mouse_in': {},
        'mouse_out': {}
    };

    // glob_dict_hover.mouse_in['search_query'] = []
    // glob_dict_hover.mouse_out['search_query'] = []
    trackHoverIntent("#search_query", 150, 0, screen_size);

    //
    // glob_dict_hover.mouse_in['serp_0'] = []
    // glob_dict_hover.mouse_out['serp_0'] = []
    trackHoverIntent("#search_result_container li", 150, 0, screen_size);

</script>

<script>
    var checks = document.querySelectorAll(".check");
    var max = 2;
    for (var i = 0; i < checks.length; i++)
      checks[i].onclick = selectiveCheck;
    function selectiveCheck (event) {
      var checkedChecks = document.querySelectorAll(".check:checked");
      if (checkedChecks.length >= max + 1)
        return false;
    }

  $('#questions_frame').hide();
  $(document).ready(function() {
    var content = $('#instructionBody1');
    var hide = $('#hideButton');

    hide.click(function(){
      content.toggle();
      $(this).hide();
      //$('#submitButton').show();
      document.getElementById("submitButton").style.visibility='visible';
      $('#questions_frame').show();
      });
    });



    $(document).ready(function () {

        $('#submitButton').click(function () {
             $('#mouse_hover_events').val(JSON.stringify(glob_dict_hover));
             $('#checkedboxlist').val(checkedCheckboxeslist);
             $('#question1_answer').val($('#select1').find(":selected").text());
             $('#question2_answer').val($('#select2').find(":selected").text());
             $('#question3_answer').val($('#select3').find(":selected").text());
             $('#question4_answer').val($('#select4').find(":selected").text());
            return true;
        });

    });

</script>